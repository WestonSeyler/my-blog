(window.webpackJsonp=window.webpackJsonp||[]).push([[228],{668:function(e,t,r){"use strict";r.r(t);var s=r(30),a=Object(s.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h3",{attrs:{id:"平台"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#平台"}},[e._v("#")]),e._v(" 平台")]),e._v(" "),r("ul",[r("li",[e._v("MacOS 11.2.3")]),e._v(" "),r("li",[e._v("Docker Desktop 3.3.3")]),e._v(" "),r("li",[e._v("Docker Engine: 20.10.6")]),e._v(" "),r("li",[e._v("Kubernates: v1.19.7")])]),e._v(" "),r("h3",{attrs:{id:"坑"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#坑"}},[e._v("#")]),e._v(" 坑")]),e._v(" "),r("p",[e._v("目前常用的K8S镜像库有")]),e._v(" "),r("ul",[r("li",[e._v("docker.io (docker hub公共镜像库)")]),e._v(" "),r("li",[e._v("gcr.io (Google container registry)")]),e._v(" "),r("li",[e._v("k8s.gcr.io (等同于 gcr.io/google-containers)")]),e._v(" "),r("li",[e._v("quay.io (Red Hat运营的镜像库)")])]),e._v(" "),r("p",[e._v("k8s.gcr.io 被墙，拉image可能会失败，建议去docker hub找别人的。没办法，具体"),r("a",{attrs:{href:"https://developer.aliyun.com/article/759310",target:"_blank",rel:"noopener noreferrer"}},[e._v("参见"),r("OutboundLink")],1)]),e._v(" "),r("h2",{attrs:{id:"步骤"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#步骤"}},[e._v("#")]),e._v(" 步骤")]),e._v(" "),r("ol",[r("li",[e._v("本地启动docker，检查k8s版本，是1.19.7\n"),r("code",[e._v("kubectl version")])])]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('Client Version: version.Info{Major:"1", Minor:"19", GitVersion:"v1.19.7", GitCommit:"1dd5338295409edcfff11505e7bb246f0d325d15", GitTreeState:"clean", BuildDate:"2021-01-13T13:23:52Z", GoVersion:"go1.15.5", Compiler:"gc", Platform:"darwin/amd64"}\nServer Version: version.Info{Major:"1", Minor:"19", GitVersion:"v1.19.7", GitCommit:"1dd5338295409edcfff11505e7bb246f0d325d15", GitTreeState:"clean", BuildDate:"2021-01-13T13:15:20Z", GoVersion:"go1.15.5", Compiler:"gc", Platform:"linux/amd64"}\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br")])]),r("ol",{attrs:{start:"2"}},[r("li",[e._v("安装NGINX Ingress Controller,打开"),r("a",{attrs:{href:"https://kubernetes.github.io/ingress-nginx/deploy/#docker-desktop",target:"_blank",rel:"noopener noreferrer"}},[e._v("官网"),r("OutboundLink")],1)])]),e._v(" "),r("p",[e._v("提示安装"),r("code",[e._v("kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.46.0/deploy/static/provider/cloud/deploy.yaml")])]),e._v(" "),r("p",[e._v("先浏览器打开"),r("code",[e._v("https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.46.0/deploy/static/provider/cloud/deploy.yaml")]),e._v("搜"),r("code",[e._v("image:")])]),e._v(" "),r("p",[e._v("引用了这个镜像"),r("code",[e._v("k8s.gcr.io/ingress-nginx/controller:v0.46.0@sha256:52f0058bed0a17ab0fb35628ba97e8d52b5d32299fbc03cc0f6c7b9ff036b61a")])]),e._v(" "),r("p",[e._v("本地先尝试拉下"),r("code",[e._v("docker pull k8s.gcr.io/ingress-nginx/controller:v0.46.0...")]),e._v(" 发现失败，很简单，这个镜像地址被墙了，得找替换！")]),e._v(" "),r("p",[e._v("打开 docker hub 搜 ingress-nginx-controller, 只找到了最新的【v0.45.0](https://hub.docker.com/r/willdockerhub/ingress-nginx-controller/tags?page=1&ordering=last_updated)")]),e._v(" "),r("p",[e._v("猜测差距不大，又下载打开"),r("code",[e._v("https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.45.0/deploy/static/provider/cloud/deploy.yaml")]),e._v("\n把"),r("code",[e._v("image: k8s.gcr.io/ingress-nginx/controller:v0.45.0")]),e._v(" 替换为 "),r("code",[e._v("image: willdockerhub/ingress-nginx-controller:v0.45.0")])]),e._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),r("p",[e._v("这步非常重要哦")])]),e._v(" "),r("ol",{attrs:{start:"3"}},[r("li",[e._v("我重命名为了"),r("code",[e._v("v0.45.0-deploy.yaml")]),e._v(" "),r("code",[e._v("kubectl apply -f v0.45.0-deploy.yaml")])])]),e._v(" "),r("p",[e._v("验证\n"),r("code",[e._v("kubectl get pods --all-namespaces -l app.kubernetes.io/name=ingress-nginx")])]),e._v(" "),r("p",[r("code",[e._v("kubectl describe pod")])]),e._v(" "),r("ol",{attrs:{start:"4"}},[r("li",[e._v("跑一个例子")])]),e._v(" "),r("p",[e._v("准备文件，下载sample")]),e._v(" "),r("p",[e._v("运行他们")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v(" kubectl apply -f sample/apple.yaml \n kubectl apply -f sample/banana.yaml \n kubectl apply -f sample/ingress.yaml \n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br")])]),r("p",[e._v("注意"),r("code",[e._v("ingress.yaml")]),e._v("我配置的域名是"),r("code",[e._v("ingress.finley.demo")]),e._v("需要让本地访问")]),e._v(" "),r("ol",{attrs:{start:"5"}},[r("li",[r("p",[e._v("打开 /etc/hosts\n添加"),r("code",[e._v("127.0.0.1 ingress.finley.demo")])])]),e._v(" "),r("li",[r("p",[e._v("见证奇迹时刻")])])]),e._v(" "),r("p",[e._v("浏览器打开 "),r("code",[e._v("http://ingress.finley.demo/apple")]),e._v(" 页面显示 apple\n浏览器打开 "),r("code",[e._v("http://ingress.finley.demo/banana")]),e._v(" 页面显示 banana\n其实就是个代理")]),e._v(" "),r("div",{staticClass:"custom-block warning"},[r("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),r("p",[e._v("本地测试如果装了valet最好先关掉，否则容易看不到结果"),r("code",[e._v("valet stop")])])]),e._v(" "),r("p",[e._v("一图看流程\n"),r("img",{attrs:{src:"https://gitee.com/Finley/upic/raw/master/picGo/20210603144746.png",alt:""}})]),e._v(" "),r("h2",{attrs:{id:"参考"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),r("p",[e._v("https://kubernetes.github.io/ingress-nginx/deploy/#docker-desktop")]),e._v(" "),r("p",[e._v("https://developer.aliyun.com/article/759310")]),e._v(" "),r("p",[e._v("http://threelambda.com/2020/07/06/run-ingress-example-on-mac/")])])}),[],!1,null,null,null);t.default=a.exports}}]);