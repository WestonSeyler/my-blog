(window.webpackJsonp=window.webpackJsonp||[]).push([[396],{834:function(s,a,n){"use strict";n.r(a);var e=n(30),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"创建新站点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建新站点"}},[s._v("#")]),s._v(" 创建新站点")]),s._v(" "),n("p",[s._v("安装完nginx，会有sites-available和sites-enabled目录，只有在sites-enabled目录下创建的站点配置文件才会生效，\n但是我们一般在sites-available目录下站点配置文件，然后软链接到sites-enabled，\n这样有个好处是假设下面的 www.booking.com 站点不需要了，只需要删掉sites-enabled/www.booking.com文件即可，他只是链接文件，源文件还是在sites-available目录下面，方便还原。")]),s._v(" "),n("h2",{attrs:{id:"basic认证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#basic认证"}},[s._v("#")]),s._v(" basic认证")]),s._v(" "),n("p",[s._v("有些网站页面需要输入正确的用户名和密码才能打开")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a14be72019cf437bab3466456da0827a~tplv-k3u1fbpfcp-watermark.image",alt:""}})]),s._v(" "),n("p",[s._v("实现方法也比较简单")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo apt-get install apache2-utils\ncd /etc/nginx\n# 使用htpasswd命令创建用户demo,密码123456文件名htpasswd的验证文件\nsudo htpasswd -bc htpasswd demo 123456\n# 编辑 nginx 站点配置文件\n# 加入下面两行到 server 或 location 段中\nauth_basic 'Restricted';  # 认证名称，随意填写 \nauth_basic_user_file /usr/local/nginx/htpasswd; # 认证的密码文件，需要生成。\n# 重启 nginx\nsudo nginx -t && sudo nginx -s reload\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h2",{attrs:{id:"显示目录文件列表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#显示目录文件列表"}},[s._v("#")]),s._v(" 显示目录文件列表")]),s._v(" "),n("p",[s._v("场景：有个存放每日备份数据库或日志的目录，希望显示列表，方便下载文件\n"),n("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d07ab6b8a0fe4a3d92c87bf0766afca3~tplv-k3u1fbpfcp-watermark.image",alt:""}})]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location / {\n   root /data/www/file                   //指定实际目录绝对路径；\n   autoindex on;                         //开启目录浏览功能；\n   autoindex_exact_size off;             //关闭详细文件大小统计，让文件大小显示MB，GB单位，默认为b；\n   autoindex_localtime on;              //开启以服务器本地时区显示文件修改日期！\n   charset utf-8,gbk;                   //避免中文乱码\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("另外，如果希望请求文件是下载而不是显示内容，可以通过添加下面参数实现：\n"),n("code",[s._v("add_header Content-Disposition attachment;")])]),s._v(" "),n("h2",{attrs:{id:"反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[s._v("#")]),s._v(" 反向代理")]),s._v(" "),n("p",[s._v("我们只需要记得正向代理代理的对象是客户端，最常见的就是VPN软件")]),s._v(" "),n("p",[s._v("反向代理代理的对象是服务端")]),s._v(" "),n("p",[s._v("客户端本来可以直接通过HTTP协议访问某网站应用服务器，如果网站管理员在中间加上一个Nginx，客户端请求Nginx，Nginx请求应用服务器，然后将结果返回给客户端，此时Nginx就是反向代理服务器。")]),s._v(" "),n("p",[s._v("例子：Nginx监听来自外部访问80的请求，转发给自己服务器占用18083端口的服务")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n    listen 80;\n    index index.html index.htm index.nginx-debian.html;\n    server_name mqtt.demo.com;\n    location / {\n      proxy_pass  http://127.0.0.1:18083;\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"关于-try-files-指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关于-try-files-指令"}},[s._v("#")]),s._v(" 关于 try_files 指令")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location / {\n    # First attempt to serve request as file, then\n    # as directory, then fall back to displaying a 404.\n    # $uri 是变量 如 www.xxx.com/aaa.php 则 $uri是aaa.php\n    # 假设我们访问/a.php 先判断 a.php是不是文件,是返回\n    # 如果不是再判断是不是目录（$uri/）,是返回\n    # 如果都不是则返回404\n    try_files $uri $uri/ =404;\n}\n#  所有的请求引导到index.php中\ntry_files $uri $uri/   /index.php?$query_string  =404;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h2",{attrs:{id:"符号的使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#符号的使用"}},[s._v("#")]),s._v(" @ 符号的使用")]),s._v(" "),n("p",[s._v("@用于定义一个 location 块，且该块不能被外部 Client 所访问，只能被 Nginx 内部配置指令所访问，比如 try_files")]),s._v(" "),n("p",[s._v("c49fb81c8f9141ae3fe7f9db2da60bd7.htm 实际上个不存在的文件，\n下面的含义的如果访问项目根目录或blog目录底下的以php结尾的文件都走php fpm解析流程")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location ~ \\.php$ {\n    try_files /c49fb81c8f9141ae3fe7f9db2da60bd7.htm @php;\n}\nlocation /blog/\\.php$ {\n    try_files /c49fb81c8f9141ae3fe7f9db2da60bd7.htm @php;\n}\nlocation @php {\n    try_files $uri =404;\n    include /etc/nginx/fastcgi_params;\n    fastcgi_pass unix:/var/lib/php7.2-fpm/web10.sock;\n    fastcgi_index index.php;\n    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    fastcgi_intercept_errors on;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h2",{attrs:{id:"使用nginx解决跨域问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用nginx解决跨域问题"}},[s._v("#")]),s._v(" 使用Nginx解决跨域问题")]),s._v(" "),n("p",[s._v("当公司存在多个域名时，两个不同的域名相互访问就会存在跨域问题。")]),s._v(" "),n("p",[s._v("或者在进行前端开发时，通常前端代码在本地启动，而后端代码会部署在一台专用的后端开发服务器上，此时前端去调用后端接口时，就会出现跨域问题。")]),s._v(" "),n("p",[s._v("解决跨域的方法有很多，今天来说一下如何使用Nginx来解决跨域问题。")]),s._v(" "),n("p",[s._v("假设后端服务器，是使用Nginx作为对外统一入口的，在Nginx配置文件的server块中增加如下配置：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 允许跨域请求的域名，*代表所有\nadd_header 'Access-Control-Allow-Origin' *;\n# 允许带上cookie请求\nadd_header 'Access-Control-Allow-Credentials' 'true';\n# 允许请求的方法，例如：GET、POST、PUT、DELETE等，*代表所有\nadd_header 'Access-Control-Allow-Methods' *;\n# 允许请求的头信息，例如：DNT,X-Mx-ReqToken,Keep-Alive,User-Agent等，*代表所有\nadd_header 'Access-Control-Allow-Headers' *;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("重新加载Nginx，便发现，已经可以跨域访问了。")]),s._v(" "),n("h2",{attrs:{id:"验证头信息中的-referer-参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#验证头信息中的-referer-参数"}},[s._v("#")]),s._v(" 验证头信息中的 referer 参数")]),s._v(" "),n("p",[s._v("请求头信息中的 referer 参数，记录了上一个页面的地址，Nginx可以对其进行校验，达到防盗链的目的。")]),s._v(" "),n("p",[s._v("通常在配置文件的location块中增加配置。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n    listen       80;   # 端口\n    server_name  www.osvlabs.com;  # 服务名，可以是IP地址或者域名\n\n    location / {   # 根路径\n　　　　　root   html;  # 对应nginx安装目标下的html文件夹\n        index  hello.html; # 指定首页为 hello.html\n    }\n\n    location ~* \\.(GIF|PNG|jpg|bmp|jpeg) {  # *代表不区分大小写\n        # 校验请求是否来自于osvlabs.com这个站点，不是则返回404页面\n    　　valid_referers *.osvlabs.com;\n    　　if ($invalid_referer) {\n           return 404;\n    　　}\n　　　　 root /home/img;\n　　}\n\n    error_page 500 502 503 504  /50x.html;  # 指定这些状态码跳转的错误页\n    location = /50x.html {\n        root   html;\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("h2",{attrs:{id:"nginx构建tomcat集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx构建tomcat集群"}},[s._v("#")]),s._v(" Nginx构建Tomcat集群")]),s._v(" "),n("p",[s._v("Nginx最常用的一个功能，就是为Tomcat构建集群，以达到实现高并发、高可用的目的。")]),s._v(" "),n("p",[s._v("首先在 upstream 块中，配置Tomcat集群中的服务地址，然后在location块中配置转发请求到此 upstream。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 配置Tomcat集群中的服务器\nupstream osvlabs {\n    server 192.168.1.101:8080;\n    server 192.168.1.102:8080;\n    server 192.168.1.103:8080;\n}\n\nserver {\n    listen  80;\n    server_name     www.osvlabs.com;\n\n    location / {\n        proxy_pass      http://osvlabs;\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("默认按所有机器权重为1的轮询方式对集群服务进行访问，每个服务访问1次，然后访问下一个服务，适合集群中每台服务器性能差不多的情况。")]),s._v(" "),n("p",[s._v("权重配置也是经常用的，适用于机器性能有差异的情况。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream osvlabs {\n　　server 192.168.1.101:8080  weight=1;\n　　server 192.168.1.102:8080;\n　　server 192.168.1.103:8080  weight=3;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("weight 就是权重配置，不配默认是1，按照以上配置，在5次请求中，101和102会被访问1次，103会被访问3次。")]),s._v(" "),n("p",[s._v("使用down，可以标识某个服务已停用，Nginx便不会去访问他了。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream osvlabs {\n    server 192.168.1.101:8080;\n    server 192.168.1.102:8080 down;\n    server 192.168.1.103:8080;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("使用backup，可以标识101是备用机，当102、103宕机后，101会进行服务。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream osvlabs {\n    server 192.168.1.101:8080 backup;\n    server 192.168.1.102:8080;\n    server 192.168.1.103:8080;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("使用 max_fails 和 fail_timeout 将服务动态停用")]),s._v(" "),n("p",[s._v("max_fails 默认是1，fail_timeout默认是10s")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream osvlabs {\n    server 192.168.1.101:8080 max_fails=2 fail_timeout=10s;\n    server 192.168.1.102:8080;\n    server 192.168.1.103:8080;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("如此配置，101服务器在10秒内如果失败次数达到2次，会停用10秒。10秒后，会尝试连接101服务器，如果连接成功则恢复轮询方式，如果不成功，再等待10秒尝试。")]),s._v(" "),n("h2",{attrs:{id:"使用keepalive设置长链接数量-提高吞吐量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用keepalive设置长链接数量-提高吞吐量"}},[s._v("#")]),s._v(" 使用keepalive设置长链接数量，提高吞吐量")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('upstream osvlabs {\n    server 192.168.1.101:8080;\n    server 192.168.1.102:8080;\n    server 192.168.1.103:8080;\n    \n    keepalive 50;\n}\n\n server {\n    listen  80;\n    server_name     www.osvlabs.com;\n\n    location / {\n        proxy_pass      http://osvlabs;\n        \n        proxy_http_version    1.1;\n        proxy_set_header    Connection "";\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("需要在upstream块中增加 keepalive 配置，在server的location块中增加 proxy_http_version 和 proxy_set_header 配置。")]),s._v(" "),n("p",[s._v("这样设置可以减少连接断开、新建的损耗，增加吞吐量。")]),s._v(" "),n("h2",{attrs:{id:"其他负载均衡策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他负载均衡策略"}},[s._v("#")]),s._v(" 其他负载均衡策略")]),s._v(" "),n("p",[s._v("除了前面说到的轮询方式，Nginx在负载均衡时，还有其他策略。")]),s._v(" "),n("ul",[n("li",[s._v("ip_hash：以客户端IP地址为依据，匹配服务器。")]),s._v(" "),n("li",[s._v("hash $request_uri：以请求的URL为依据，匹配服务器。")]),s._v(" "),n("li",[s._v("least_conn：以服务器连接数为依据，哪个服务器连接数少，匹配哪台服务器")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream osvlabs {\n    # ip_hash;\n    # hash $request_uri;\n    least_conn;\n\n    server 192.168.1.101:8080;\n    server 192.168.1.102:8080;\n    server 192.168.1.103:8080;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);