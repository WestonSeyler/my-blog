(window.webpackJsonp=window.webpackJsonp||[]).push([[152],{588:function(e,s,a){"use strict";a.r(s);var r=a(30),t=Object(r.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h3",{attrs:{id:"免sudo执行docker和docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#免sudo执行docker和docker-compose"}},[e._v("#")]),e._v(" 免sudo执行docker和docker-compose")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://docs.docker.com/install/linux/linux-postinstall",target:"_blank",rel:"noopener noreferrer"}},[e._v("官方文档"),a("OutboundLink")],1),e._v(" 有介绍")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 创建名为docker的用户组")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("groupadd")]),e._v(" docker\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 把当前用户加入到这个用户组中")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("usermod")]),e._v(" -aG docker "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("$USER")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 重登session")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 测试，不带sudo跑一个测试镜像")]),e._v("\ndocker run hello-world\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("h3",{attrs:{id:"跟随系统自自动docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跟随系统自自动docker"}},[e._v("#")]),e._v(" 跟随系统自自动docker")]),e._v(" "),a("p",[a("code",[e._v("sudo systemctl enable docker")])]),e._v(" "),a("ul",[a("li",[e._v("Docker Machine 的目的是简化 Docker 的安装和远程管理。\n通过 docker-machine 命令我们可以轻松的在远程主机上安装 Docker。")]),e._v(" "),a("li",[e._v("pull 镜像的时候最好指定tag，不然默认会用latest。会导致版本问题。\n如 pull mysql 会拉最新的8.0")]),e._v(" "),a("li",[a("code",[e._v("CMD echo $HOME")]),e._v(" ， 在实际执行中，会将其变更为："),a("code",[e._v('CMD [ "sh", "-c", "echo $HOME" ]')]),e._v("， 所以 "),a("code",[e._v("CMD service nginx start")]),e._v(" 不对，要使用 "),a("code",[e._v('CMD ["nginx", "-g", "daemon off;"]')])])]),e._v(" "),a("p",[e._v("docker build 会加入上下文\n如果加入")]),e._v(" "),a("p",[e._v(".dockerignore 指定忽略目录文件")]),e._v(" "),a("h3",{attrs:{id:"实用的命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实用的命令"}},[e._v("#")]),e._v(" 实用的命令")]),e._v(" "),a("p",[e._v("根据容器名称查询容器ID并删除")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 第一种写法\n\ndocker stop `docker ps -a| grep test-project | awk '{print $1}' `\ndocker rm   `docker ps -a| grep test-project | awk '{print $1}' `\n\n# 第二种写法\ndocker stop  `docker ps -aq --filter name=test-project`\ndocker rm    `docker ps -aq --filter name=test-project`\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("p",[e._v("根据镜像名称查询容器ID并删除")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 第一种写法\ndocker stop `docker ps -a| grep ygsama/test-project:1.0.2 | awk '{print $1}' `\ndocker rm   `docker ps -a| grep ygsama/test-project:1.0.2 | awk '{print $1}' `\n\n# 第二种写法\ndocker stop  `docker ps -aq --filter ancestor=ygsama/test-project:1.0.2`\ndocker rm   `docker ps -aq --filter ancestor=ygsama/test-project:1.0.2`\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("p",[e._v("根据镜像名称查询镜像ID并删除")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("docker images -q --filter reference=ygsama/test-project*:*\ndocker image rm `docker images -q --filter reference=10.2.21.95:10001/treasury-brain*:*`\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h3",{attrs:{id:"docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[e._v("#")]),e._v(" docker-compose")]),e._v(" "),a("ol",[a("li",[e._v("env问题")]),e._v(" "),a("li",[e._v("重启 php-fpm")]),e._v(" "),a("li",[e._v("慎用 docker-compose down")]),e._v(" "),a("li",[e._v("环境变量 优先级 shell > .env")]),e._v(" "),a("li",[e._v("执行 "),a("code",[e._v("docker-compose up")]),e._v("  之前执行先执行  "),a("code",[e._v("docker-compose config")]),e._v("就是把实际要运行的docker-compose.yml内容打印出来")])]),e._v(" "),a("p",[e._v("Windows 操作系统底下经常会有文件字符集问题，比如报\n"),a("code",[e._v("<input>:1:13: illegal character NUL")]),e._v("，需要转换成unix文件格式\n可以打开 git bash 运行 dos2unix 后跟文件名")]),e._v(" "),a("p",[e._v("参考：")]),e._v(" "),a("ul",[a("li",[e._v("https://docs.docker.com/compose/compose-file/#variable-substitution")]),e._v(" "),a("li",[e._v("https://docs.docker.com/compose/environment-variables/#the-env-file")])])])}),[],!1,null,null,null);s.default=t.exports}}]);