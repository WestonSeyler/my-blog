(window.webpackJsonp=window.webpackJsonp||[]).push([[189],{626:function(s,n,t){"use strict";t.r(n);var a=t(30),e=Object(a.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("服务器确保已经安装了docker和docker-compose。\n当前用的是\nDocker version 18.09.7, build 2d0083d\ndocker-compose version 1.24.0, build 0aa59064")]),s._v(" "),t("p",[s._v("下面的操作是当执行 docker 或 docker-compose 不用带 sudo")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建名为docker的用户组")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" docker\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把当前用户加入到这个用户组中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" -aG docker "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$USER")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重登session")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试，不带sudo跑一个测试镜像")]),s._v("\ndocker run hello-world\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("新建 jenkins 用户")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建jenkins用户并添加同名组、创建用户目录,默认shell为bash")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -mU jenkins -s /bin/bash \n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" jenkins "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重置密码")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" jenkins "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用jenkins用户登录")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~ "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入/home/jenkins目录")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("新建 jenkins-compose目录并在里面添加"),t("code",[s._v("docker-compose.yml")]),s._v(" 文件，内容如下：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jenkins-compose")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意镜像名称，lts表示长期支持版")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jenkins/jenkins"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("lts\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解决权限问题")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8088:8080"')]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"50000:50000"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" JAVA_OPTS="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Duser.timezone=Asia/Shanghai\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /var/run/docker.sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/run/docker.sock\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /usr/bin/docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/bin/docker\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /home/ubuntu/jenkins"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/jenkins_home\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("执行 "),t("code",[s._v("docker-compose up -d jenkins-compose")]),s._v(" 会下载镜像并在后台启动\n然后 "),t("code",[s._v("docker-compose logs")]),s._v("  查看日志")]),s._v(" "),t("p",[s._v("留意并复制红框中的密码")]),s._v(" "),t("blockquote",[t("p",[t("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/2019/8/24/16cc3eaa69000662?w=1240&h=606&f=png&s=478129",alt:"image.png"}})])]),s._v(" "),t("p",[s._v("浏览器打开Jenkins地址，地址应该是服务器ip:8088")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("打不开的话检查下防火墙开放8088端口")])]),s._v(" "),t("p",[s._v("粘贴刚复制的密码，点Continue")]),s._v(" "),t("blockquote",[t("p",[t("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/2019/8/24/16cc3eaa6915503b?w=1240&h=907&f=png&s=139020",alt:"image.png"}})])]),s._v(" "),t("p",[s._v("安装插件，建议选第一个")]),s._v(" "),t("blockquote",[t("p",[t("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/2019/8/24/16cc3eaa69463235?w=1240&h=981&f=png&s=190192",alt:"image.png"}})])]),s._v(" "),t("p",[s._v("安装完成后会自动跳转到管理员用户界面")]),s._v(" "),t("blockquote",[t("p",[t("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/2019/8/24/16cc3eaa695b87a7?w=1240&h=909&f=png&s=76171",alt:"image.png"}})])]),s._v(" "),t("p",[s._v("最终来到了欢迎页面")]),s._v(" "),t("blockquote",[t("p",[t("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/2019/8/24/16cc3eaa697012dd?w=1240&h=671&f=png&s=99707",alt:"image.png"}})])]),s._v(" "),t("h4",{attrs:{id:"修改时区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改时区"}},[s._v("#")]),s._v(" 修改时区")]),s._v(" "),t("p",[s._v("在【系统管理】-【脚本命令行】里运行\n"),t("code",[s._v("System.setProperty('org.apache.commons.jelly.tags.fmt.timeZone', 'Asia/Shanghai')")])]),s._v(" "),t("h4",{attrs:{id:"修改jenkins插件为国内源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改jenkins插件为国内源"}},[s._v("#")]),s._v(" 修改Jenkins插件为国内源")]),s._v(" "),t("p",[s._v("首页 --\x3e configure --\x3e Manage Jenkins --\x3e Advanced --\x3e Update Site（页面最下方‘升级站点’）")]),s._v(" "),t("p",[s._v("替换URL为 清华大学仓库地址：")]),s._v(" "),t("p",[s._v("https://updates.jenkins.io/update-center.json\n改为\nhttps://mirror.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json")]),s._v(" "),t("p",[s._v("如果插件页面为空，把https改为http")]),s._v(" "),t("h4",{attrs:{id:"问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题：")]),s._v(" "),t("ul",[t("li",[s._v("Jenkins更新比较频繁，如何更新版本？\n见 medium 的这篇 "),t("a",{attrs:{href:"https://medium.com/@jimkang/how-to-start-a-new-jenkins-container-and-update-jenkins-with-docker-cf628aa495e9",target:"_blank",rel:"noopener noreferrer"}},[s._v("文章"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);n.default=e.exports}}]);