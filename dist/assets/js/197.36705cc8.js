(window.webpackJsonp=window.webpackJsonp||[]).push([[197],{635:function(t,e,s){"use strict";s.r(e);var a=s(30),r=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("制品是软件开发过程中产生的多种有形副产品之一，个人理解，比如前端build后产生的dist静态资源文件，安卓打包生成的apk文件，这些产物都可以认为是制品。\n制品的使用可以非常简单。\n比如下面的流水线Job。\n第一步拉代码，仓库中存在一个名为"),s("code",[t._v("Dockerfile")]),t._v("的文件。\n第二步把文件存为制品。")]),t._v(" "),s("div",{staticClass:"language-groovy line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-groovy"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang comment"}},[t._v("#!groovy")]),t._v("\n\npipeline "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent any\n    stages "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'checkout'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n               git "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://git.dev.tencent.com/finley/angular-js.git'")]),t._v("\n               archiveArtifacts "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Dockerfile'")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("        \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br")])]),s("p",[t._v("然后在Jenkins 构建页面中就可以直接查看和下载制品")]),t._v(" "),s("blockquote",[s("p",[s("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-d2f84760216093f3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])]),t._v(" "),s("h4",{attrs:{id:"archiveartifacts-指令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#archiveartifacts-指令"}},[t._v("#")]),t._v(" archiveArtifacts 指令")]),t._v(" "),s("p",[t._v("参数：")]),t._v(" "),s("ul",[s("li",[t._v("artifacts 只有这一个参数是必填的，需要归档的文件路径，可以是Ant文件风格的路径表达式")]),t._v(" "),s("li",[t._v("fingerprint |  布尔  | 是否对归档文件进行签名")]),t._v(" "),s("li",[t._v("excludes 需要排除的文件路径，可以是Ant文件风格的路径表达式")]),t._v(" "),s("li",[t._v("onlyIfSuccessful  |  布尔  |  只在构建成功时进行归档")]),t._v(" "),s("li",[t._v("allowEmptyArchive |  布尔 |  如果归档文件没有返回任何结果，不构建失败")])]),t._v(" "),s("blockquote",[s("p",[s("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-09b0265b57e691c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])]),t._v(" "),s("h4",{attrs:{id:"制品管理软件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#制品管理软件"}},[t._v("#")]),t._v(" 制品管理软件")]),t._v(" "),s("p",[t._v("制品多了话需要管理，单靠Jenkins有点力不从心了，需要专门的制品管理软件，目前流行的有"),s("a",{attrs:{href:"https://www.sonatype.com/download-oss-sonatype",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nexus Repository OSS"),s("OutboundLink")],1),t._v(" 和 "),s("a",{attrs:{href:"https://jfrog.com/open-source/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Artifactory"),s("OutboundLink")],1),t._v("\n他们都提供免费的社区版和收费的专业版，安装可以使用Docker镜像，省时省力。")]),t._v(" "),s("p",[t._v("以Nexus为例，制品软件系统到底有啥用呢，通过"),s("a",{attrs:{href:"https://help.sonatype.com/repomanager3/formats",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),s("OutboundLink")],1),t._v("，通过Nexus制品管理软件。有以下功能\n可以方便的搭建使用自己的私有Docker仓库，Composer， NPM，Raw(任何文件格式) 等。\n更好的文件分类，更好的角色权限控制\n支持REST API\n更好的备份恢复机制\n所以个人觉得大公司很有必要建立的自己制品管理系统。")]),t._v(" "),s("p",[t._v("缺点: 自己搭建和维护，需要一定服务器运行成本")]),t._v(" "),s("p",[t._v("制品管理软件详细的使用本文不再展开，大家参照文档即可，大致流程是: 搭建制品仓库系统，Jenkins安装对应的插件，修改pipeline通过插件提供的指令上传制品到制品仓库。供系统项目或人员使用")]),t._v(" "),s("p",[t._v("如果只是为了Docker私有仓库，不用搭建Nexus，阿里云，腾讯云等公有云提供的有类似服务而且是免费的。")]),t._v(" "),s("h4",{attrs:{id:"使用-nexus3-搭建-私有docker仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-nexus3-搭建-私有docker仓库"}},[t._v("#")]),t._v(" 使用 nexus3 搭建 私有Docker仓库")]),t._v(" "),s("p",[t._v("最快的方法使")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker run -d --name nexus3 --restart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("always "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v(":8081 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --mount "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nexus-data,target"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/nexus-data "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    sonatype/nexus3\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("等待 3-5 分钟，如果 nexus3 容器没有异常退出，那么你可以使用浏览器打开 http://YourIP:8081 访问 Nexus 了。")]),t._v(" "),s("p",[t._v("第一次启动 Nexus 的默认帐号是 admin 密码是 通过 "),s("code",[t._v("docker exec -it nexus3 cat /nexus-data/admin.password")]),t._v(" 获取，登录以后点击页面上方的齿轮按钮进行设置。")]),t._v(" "),s("blockquote",[s("p",[s("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-f8a2dbb16d4c1645.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])]),t._v(" "),s("p",[t._v("创建一个私有仓库的方法： Repository->Repositories 点击右边菜单 Create repository 选择 docker (hosted)")]),t._v(" "),s("p",[t._v("Name: 仓库的名称\nHTTP: 仓库单独的访问端口\nEnable Docker V1 API: 如果需要同时支持 V1 版本请勾选此项（不建议勾选）。\nHosted -> Deployment policy: 请选择 Allow redeploy 否则无法上传 Docker 镜像。\n其它的仓库创建方法请各位自己摸索，还可以创建一个 docker (proxy) 类型的仓库链接到 DockerHub 上。再创建一个 docker (group) 类型的仓库把刚才的 hosted 与 proxy 添加在一起。主机在访问的时候默认下载私有仓库中的镜像，如果没有将链接到 DockerHub 中下载并缓存到 Nexus 中。")]),t._v(" "),s("p",[t._v("详细内容请自行查看 Nexus 文档")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-1b372b24c25ff95b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),t._v(" "),s("h4",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://help.sonatype.com/repomanager3/formats/docker-registry",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://help.sonatype.com/repomanager3/formats/docker-registry"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://jfrog.com/open-source/#",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://jfrog.com/open-source/#"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://yeasy.gitbooks.io/docker_practice/repository/nexus3_registry.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://yeasy.gitbooks.io/docker_practice/repository/nexus3_registry.html"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=r.exports}}]);