(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{498:function(n,s,e){"use strict";e.r(s);var a=e(30),t=Object(a.a)({},(function(){var n=this,s=n.$createElement,e=n._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("p",[n._v("上面的例子中我们创建的channel频道是公有的，任何人都可以监听。")]),n._v(" "),e("p",[n._v("现实中，私有频道会更常见")]),n._v(" "),e("ol",[e("li",[n._v("服务端修改频道类型有私有")])]),n._v(" "),e("p",[n._v("app/Events/TaskEvent.php")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("    public function broadcastOn()\n    {\n        // return new Channel('task-event');\n        return new PrivateChannel('task-event');\n    }\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[n._v("相应的客户端也要改")])]),n._v(" "),e("p",[n._v("resources/js/components/ExampleComponent.vue")]),n._v(" "),e("div",{staticClass:"language-vue line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-vue"}},[e("code",[n._v("    mounted() {\n        let that = this;\n        Echo.private('task-event')\n            .listen('TaskEvent', (e) => {\n                console.log(e);\n                that.items.push(e)\n            });\n    }\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br")])]),e("p",[n._v("刷新浏览器发现多出一个请求")]),n._v(" "),e("p",[e("code",[n._v("http://demo.lara.test/broadcasting/auth")]),n._v(" 并且返回403 Forbidden")]),n._v(" "),e("p",[n._v("也就是说，客户端接收频道消息要授权")]),n._v(" "),e("p",[n._v("怎么判断授权是否成功？我们打开\nroutes/channels.php")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("Broadcast::channel('task-event', function ($user) {\n    // 在这里可以做复杂的权限判断\n    return $user->id;\n});\n\n/*\n// 注意传参\nBroadcast::channel('task-event/{id}', function ($user, $id) {\n    // 在这里可以做复杂的权限判断\n    return $user->id;\n});\n*/\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);