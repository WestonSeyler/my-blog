(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{519:function(e,s,a){"use strict";a.r(s);var n=a(30),t=Object(n.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("传统中发送邮件是同步执行的，这样用户体验很不好，页面会停留几秒钟。因为需要等邮件发送的返回响应")]),e._v(" "),a("p",[a("code",[e._v("Mail::to('mafeifan@qq.com')->send(new TestQueue());")])]),e._v(" "),a("p",[e._v("TestQueue是邮件内容，用 "),a("code",[e._v("php artisan make:mail TestQueue")]),e._v(" 生成")]),e._v(" "),a("p",[e._v("这时候可以改为队列执行。需要配置队列驱动")]),e._v(" "),a("p",[e._v("如果需要使用数据库驱动，要执行")]),e._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[e._v("php artisan queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("table\nphp artisan migrate\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("如果是redis，安装redis即可")]),e._v(" "),a("p",[e._v("把邮件放到队列中非常简单 "),a("code",[e._v("Mail::to('mafeifan@qq.com')->queue(new TestQueue());")])]),e._v(" "),a("p",[e._v("这里我们编辑"),a("code",[e._v(".env")]),e._v("将"),a("code",[e._v("QUEUE_CONNECTION")]),e._v("队列驱动从"),a("code",[e._v("sync")]),e._v("同步改为"),a("code",[e._v("redis")])]),e._v(" "),a("p",[e._v("为了监控队列的执行情况，比如成功几个，失败几个，情况如何，可以安装Horizon 队列管理工具")]),e._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[e._v("composer "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("require")]),e._v(" laravel"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),e._v("horizon\nphp artisan horizon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("install\nphp artisan queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("failed"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("table\nphp artisan migrate\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 运行 horizon")]),e._v("\nphp artisan horizon\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://pek3b.qingstor.com/hexo-blog/hexo-blog/20210124204443.png",alt:""}})])])}),[],!1,null,null,null);s.default=t.exports}}]);