(window.webpackJsonp=window.webpackJsonp||[]).push([[247],{683:function(s,a,n){"use strict";n.r(a);var t=n(30),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h4",{attrs:{id:"一、创建ssh公钥免密登陆服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、创建ssh公钥免密登陆服务器"}},[s._v("#")]),s._v(" 一、创建ssh公钥免密登陆服务器")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("执行ssh-keygen命令生成ssh密钥对\n执行后~/.ssh/目录下，会新生成两个文件：id_rsa.pub和id_rsa\n"),n("code",[s._v("ssh-keygen")])])]),s._v(" "),n("li",[n("p",[s._v("执行ssh-copy-id命令将公钥传送到服务器\n"),n("code",[s._v("ssh-copy-id root@host")])])]),s._v(" "),n("li",[n("p",[s._v("测试免密码登陆\n"),n("code",[s._v("ssh root@host")])])])]),s._v(" "),n("h4",{attrs:{id:"二、添加变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、添加变量"}},[s._v("#")]),s._v(" 二、添加变量")]),s._v(" "),n("p",[s._v("gitlab项目/群组 -> 设置 -> CI/CD -> 变量")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SSH_USER = 服务器的用户名\nSSH_HOST = 服务器ip\nSSH_KNOWN_HOSTS = 文件 ~/.ssh/known_host 有你服务器ip的一行\nSSH_PRIVATE_KEY = 文件 ~/.ssh/id_rsa 里的内容\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"三、添加-gitlab-ci-yml"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、添加-gitlab-ci-yml"}},[s._v("#")]),s._v(" 三、添加.gitlab-ci.yml")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('stage:\n  - Deploy\nDeplpy:\n  stage: Deploy\n  only:\n    - master\n  before_script:\n    - \'which ssh-agent || ( apt-get update -y && apt-get install openssh-client -y )\'\n    - eval $(ssh-agent -s)\n    - echo "$SSH_PRIVATE_KEY" | tr -d \'\\r\' | ssh-add - > /dev/null\n    - mkdir -p ~/.ssh\n    - chmod 700 ~/.ssh\n    - echo "$SSH_KNOWN_HOSTS" > ~/.ssh/known_hosts\n    - chmod 644 ~/.ssh/known_hosts\n  when: manual #手动确认之后才能构建\n  script:\n    - pwd\n    - ls -l\n    #主要同步代码的命令，可以在这里排除一些文件，同步权限，配置服务器的项目路径等。重点参考rsync命令的用法。\n    - rsync -aztp --exclude ".gitlab-ci.yml" ./ $SSH_USER@$SSH_HOST:/data/wwwroot/laravel\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h4",{attrs:{id:"四、记得配置runner"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、记得配置runner"}},[s._v("#")]),s._v(" 四、记得配置runner")])])}),[],!1,null,null,null);a.default=e.exports}}]);