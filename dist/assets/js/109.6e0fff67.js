(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{547:function(s,n,a){"use strict";a.r(n);var e=a(30),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"记录请求参数和请求内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#记录请求参数和请求内容"}},[s._v("#")]),s._v(" 记录请求参数和请求内容")]),s._v(" "),a("p",[s._v("默认morgan没有提供记录请求参数和请求内容的方法，\n但是他提供了扩展方法，如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("morgan.token('requestParameters', function(req, res){\n  return JSON.stringify(req.query) || '-';\n});\n\nmorgan.token('requestBody', function(req, res){\n  return JSON.stringify(req.body) || '-';\n});\n\n// create custom format，includes the custom token\nmorgan.format('live-api', ':method :url :status :requestParameters :requestBody');\n\napp.use(morgan('live-api'));\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"输出日志到数据库或将日志作为参数发送到其他请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#输出日志到数据库或将日志作为参数发送到其他请求"}},[s._v("#")]),s._v(" 输出日志到数据库或将日志作为参数发送到其他请求")]),s._v(" "),a("p",[s._v("默认日志信息是输出到命令行窗口中，能否输出到文件或数据库中呢？答案是肯定的\n定义morgan的options中有个stream配置项，我们可以利用他做文章。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const request = require('request')\nconst split = require('split')\n\n// 将日志信息作为请求参数传给其他地址，比如 Elasticsearch 日志分析系统\nlet httpLogStream = split().on('data', function (line) {\n  request({\n    url: 'localhost://192.168.1.1:8080',\n    method: 'POST',\n    body: line\n  })\n  .on('response', function(response) {\n    console.log(response.statusCode) // 200\n  })\n});\n\napp.use(morgan('common', {\n  stream: httpLogStream\n}));\n\n\n// 将日志写入数据库\n// 带write方法的对象\nlet dbStream = {\n  write: function(line){\n    saveToDatabase(line);  // 伪代码，保存到数据库\n  }\n};\n\n// 将 dbStream 作为 stream 配置项的值\napp.use(morgan('short', {stream: dbStream}));\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);