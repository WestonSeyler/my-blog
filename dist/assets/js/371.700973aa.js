(window.webpackJsonp=window.webpackJsonp||[]).push([[371],{809:function(s,a,n){"use strict";n.r(a);var e=n(30),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h3",{attrs:{id:"响应式表单"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#响应式表单"}},[s._v("#")]),s._v(" 响应式表单")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://angular.cn/api/forms/FormControl",target:"_blank",rel:"noopener noreferrer"}},[n("code",[s._v("FormControl")]),n("OutboundLink")],1),s._v(" 的 "),n("code",[s._v("valueChanges")]),s._v(" 属性和 "),n("code",[s._v("statusChanges")]),s._v(" 属性包含了会发出变更事件的可观察对象。\n"),n("a",{attrs:{href:"https://stackblitz.com/edit/angular-form-rxjs-demo",target:"_blank",rel:"noopener noreferrer"}},[s._v("例子"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import { Component, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators, FormControl, AbstractControl } from '@angular/forms';\nimport { concat, merge, zip, combineLatest, race } from 'rxjs/index';\nimport { filter, map, startWith,  } from 'rxjs/internal/operators';\n\n@Component({\n  selector: 'my-app',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})\nexport class AppComponent implements OnInit {\n  form: FormGroup;\n  constructor(\n    private formBuilder: FormBuilder,\n  ) { }\n\n  ngOnInit() {\n    this.form = this.formBuilder.group({\n      username: ['', Validators.required],\n      hobby: [''],\n    });\n\n    //  监听整个表单\n    this.form.valueChanges\n          .subscribe( res => console.log(res));\n  }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("p",[s._v("HTML")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('<form [formGroup]="form">\n    username: <input type="text" name="username" formControlName="username">\n    hobby: \n      <select name="hobby">\n        <option value="sleep">sleep</option>\n        <option value="play">play</option>\n      </select>    \n</form>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("完善验证，只有通过验证才输出内容 filter 是rxjs提供的运算符")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    this.form.valueChanges\n    .pipe(\n      filter(() => this.form.valid)\n    )\n    .subscribe(res => console.log(res));\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("如果需要额外的逻辑，只需要在pipe添加相应的运算符。比如这里在结果里追加上次更新时间，字段名为lastTime")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    this.form.valueChanges\n    .pipe(\n      filter(() => this.form.valid)，\n      map(data => {\n        data.lastTime = new Date();\n        return data\n     })\n    )\n    .subscribe(res => console.log(res));\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("另一种写法，监听各个元素")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    // 如果要监听单个表单元素\n    const username$ = this.form.get('username').pipe(startWith(this.form.get('username').value))\n    const hobby$ = this.form.get('hobby').pipe(startWith(this.form.get('hobby').value))\n    //  combineLatest，它会取得各个 observable 最后送出的值，再输出成一个值\n    //  这个有个问题是只有合并的元素都产生值才会输出内容，所以在上面使用startWith赋初始化值\n    combineLatest(username$, status$)\n      .pipe(\n        map(([username, status]) => ({username, status}))\n      )\n      .subscribe(res => console.log(res));\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"结合返回observable的组件-angular-material"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#结合返回observable的组件-angular-material"}},[s._v("#")]),s._v(" 结合返回Observable的组件 Angular Material")]),s._v(" "),n("p",[n("a",{attrs:{href:"%5Bhttps://material.angular.io%5D(https://material.angular.io/)"}},[s._v("Angular Material")]),s._v(" 是基于Angular的前端框架，国外使用度高。\n他提供的组件有些方法返回的是Observable，比如Dialog的afterAllClosed，SnackBar的afterOpened, afterDismissed\n比如某需要，提示消失1s后跳转页面\n优化前的代码：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("this.snackbar.success(response);\nsetTimeout(function () {\n    this.router.navigate([`/login`]);\n}, 1000);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("优化后的代码：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import { delay } from 'rxjs/operators';\n...\nthis.snack.success(response).afterDismissed()\n  .pipe(delay(1000))\n  .subscribe(() => {\n    this.router.navigate([`/login`]);\n  });\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);