(window.webpackJsonp=window.webpackJsonp||[]).push([[249],{686:function(s,a,e){"use strict";e.r(a);var t=e(30),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("SSH（Secure Shell 的缩写）是一种网络协议，用于加密两台计算机之间的通信，并且支持各种身份验证机制。")]),s._v(" "),e("p",[s._v("一般情况下我们可以通过 "),e("code",[s._v("ssh username@xxx.xxx.xxx.xxx")]),s._v(" 登录远程服务器，如果要管理多台服务器，这样太长了。\n可以在家目录的 .ssh 中新建config文件，设置别名。\n比如我有一台个人的云主机。IP是120.163.163.163，端口是4722(一般都是22，这里为了安全我改为了其他)，登录用户名是ubuntu，登录方式是私钥登录。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# Host 可跟多个表示别名\nHost cloud  alias\n    HostName 120.163.163.163\n    User ubuntu\n    Port 4722\n    # 私钥路径\n    IdentityFile ~/.ssh/id_rsa\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("这样执行 "),e("code",[s._v("ssh cloud")]),s._v(" 或 "),e("code",[s._v("ssh alias")]),s._v(" 就无密码登录云主机了")]),s._v(" "),e("h2",{attrs:{id:"执行远程命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行远程命令"}},[s._v("#")]),s._v(" 执行远程命令")]),s._v(" "),e("p",[e("code",[s._v('ssh cloud "df -h"')])]),s._v(" "),e("blockquote",[e("p",[e("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-6e4fb3bd80600312.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])]),s._v(" "),e("h4",{attrs:{id:"用分号分隔多个命令-用引号引起来"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用分号分隔多个命令-用引号引起来"}},[s._v("#")]),s._v(" 用分号分隔多个命令，用引号引起来")]),s._v(" "),e("p",[e("code",[s._v('ssh cloud "df -h; ps;"')])]),s._v(" "),e("h4",{attrs:{id:"遇到需要交互的命令-加-t-参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#遇到需要交互的命令-加-t-参数"}},[s._v("#")]),s._v(" 遇到需要交互的命令，加 -t 参数")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ ssh -t cloud top\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("比如 "),e("code",[s._v("sudo")]),s._v("  开头的可能需要用户输入密码，需要 TTY。\n添加 -t 参数后，ssh 会保持登录状态，直到你退出需要交互的命令。")]),s._v(" "),e("blockquote",[e("p",[e("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-1832a664f7095765.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])]),s._v(" "),e("p",[s._v("再举个实际例子：\n"),e("code",[s._v("ssh -t flux sudo -u fueladminprd ssh 192.168.1.100")]),s._v("\n这句话实际执行了两步：")]),s._v(" "),e("ol",[e("li",[s._v("ssh -t flux # 登录名为flux的服务器，因为需要交互式，加上-t")]),s._v(" "),e("li",[s._v("sudo -u fueladminprd  ssh 192.168.1.100 # 以 fueladminprd 用户在 flux 上执行 ssh 192.168.1.100\n为了安全，flux 就是跳板机，192.168.1.100 为实际测试服务器。")])]),s._v(" "),e("h4",{attrs:{id:"使用remotecommand登录后执行自定义命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用remotecommand登录后执行自定义命令"}},[s._v("#")]),s._v(" 使用RemoteCommand登录后执行自定义命令")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Host target\n    HostName xx.xx.xx.202\n    User client_admin\n    # 使用RemoteCommand登录后执行自定义命令(需要SSH版本大于等于7.6，可用ssh -V查看)\n    RemoteCommand cd /data/www/clients/client3/web160 && /bin/bash\n    # 其中RequestTTY为了避免执行ssh target之后hang住\n    RequestTTY yes\n    Port 22\n    IdentityFile ~/.ssh/id_rsa\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("如果RemoteCommand不生效, 可把ssh config中的RemoteCommand和RequestTTY删除，用如下方式：\n"),e("code",[s._v('ssh -t target "cd xxx; bash"')])]),s._v(" "),e("h4",{attrs:{id:"执行多行命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行多行命令"}},[s._v("#")]),s._v(" 执行多行命令")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ ssh cloud \"echo 'haha'\n> pwd\n> ls \"\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("可以用单引号或双引号开头，然后写上几行命令，最后再用相同的引号来结束。\n"),e("code",[s._v(">")]),s._v(" 开头的就是输入下一行命令\n如果需要在命令中使用引号，可以混合使用单双引号。")]),s._v(" "),e("blockquote",[e("p",[e("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-2f98740683ad8e74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])]),s._v(" "),e("h4",{attrs:{id:"在命令中使用变量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在命令中使用变量"}},[s._v("#")]),s._v(" 在命令中使用变量")]),s._v(" "),e("p",[s._v("在远程服务器执行 "),e("code",[s._v("ls node")]),s._v("，本地定义变量a，传入到命令中。达到一样的效果。\n在下图的命令中为 bash 指定了 -c 参数")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ a=node\n$ ssh cloud bash -c \" '\n> ls $a\n> ' \"\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("blockquote",[e("p",[e("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-69eb868388ebdc0b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])]),s._v(" "),e("h2",{attrs:{id:"执行本地脚本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行本地脚本"}},[s._v("#")]),s._v(" 执行本地脚本")]),s._v(" "),e("p",[s._v("本地创建demo.sh，内容是："),e("code",[s._v("ls node")]),s._v("\n运行 "),e("code",[s._v("ssh cloud < demo.sh")]),s._v("\n通过重定向 stdin，本地的脚本 demo.sh 在远程服务器上被执行。")]),s._v(" "),e("blockquote",[e("p",[e("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-a7b56ec7fbce3520.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])]),s._v(" "),e("h4",{attrs:{id:"为脚本传入参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#为脚本传入参数"}},[s._v("#")]),s._v(" 为脚本传入参数")]),s._v(" "),e("p",[s._v("修改 demo.sh 内容为：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ls node\necho $0\necho $1\necho $2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("执行 "),e("code",[s._v("ssh cloud 'bash -s'< demo.sh aa bb cc")]),s._v("\nbash 就是 $0 第一个参数。")]),s._v(" "),e("blockquote",[e("p",[e("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-2454d65cbf062ad0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])]),s._v(" "),e("p",[s._v("想查看更多配置，打"),e("code",[s._v("man ssh_config")])]),s._v(" "),e("h2",{attrs:{id:"跳板"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#跳板"}},[s._v("#")]),s._v(" 跳板")]),s._v(" "),e("p",[s._v("有跳板机配置在某些场景下，往往是不能直接访问目标机器的，通常是用先登录一台机器（此机器通常被称为跳板机/堡垒机/gateway），然后再在这台机器上登录目标机器，我们可以借助ssh config来简化这种操作。")]),s._v(" "),e("p",[s._v("在"),e("code",[s._v("~/.ssh/config")]),s._v("中配置：Host gateway")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("HostName $GATEWAY_HOST\nPort $GATEWAY_PORT\nIdentityFile ~/.ssh/id_rsa\nUser $GATEWAY_USER\n\nHost target\n    HostName $TARGET_HOST\n    User $TARGET_USER\n    IdentityFile ~/.ssh/id_rsa\n    ProxyCommand ssh gateway nc %h %p 2> /dev/null # 或者 ProxyCommand ssh gateway -W %h:%p\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("其中：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("%h 表示 hostname\n%p 表示 port\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("然后配置免密登录，和上面一样,也只需要第一次输入密码："),e("code",[s._v("ssh target 'mkdir -p .ssh && cat > .ssh/authorized_keys' < ~/.ssh/id_rsa.pub")]),s._v("然后可以无感知地"),e("code",[s._v("ssh/scp/rsync")]),s._v("到目标机器，在终端中也只需要输入目标机器的别名就行:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ssh target\nscp some_file target:/home/user\nrsync -avP * target:/home/user/some_dir\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考：")]),s._v(" "),e("p",[s._v("http://www.openssh.com/")]),s._v(" "),e("p",[s._v("https://www.cnblogs.com/sparkdev/p/6842805.html")]),s._v(" "),e("p",[s._v("https://www.zcfy.cc/article/top-20-openssh-server-best-security-practices")]),s._v(" "),e("p",[s._v("https://www.zhihu.com/question/28793890")])])}),[],!1,null,null,null);a.default=n.exports}}]);