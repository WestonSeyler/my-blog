(window.webpackJsonp=window.webpackJsonp||[]).push([[398],{836:function(e,t,s){"use strict";s.r(t);var o=s(30),a=Object(o.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[e._v("Firebase Cloud Messaging (FCM) 是一种跨平台(安卓，IOS，Web)消息传递解决方案，且无需任何费用。")]),e._v(" "),s("p",[e._v("最近用cordova开发app，客户希望用firebase带的消息推送功能，国内我们知道有激光推送，leancloud，而国外firebase非常出名。")]),e._v(" "),s("p",[e._v("cordova使用firebase需要注意以下几点：")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("因为firebase已被google收购，国内手机设备无法接收来自firebase的推送，除非开代理，要打开的端口和主机名见"),s("a",{attrs:{href:"https://firebase.google.com/docs/cloud-messaging/concept-options#messaging-ports-and-your-firewall",target:"_blank",rel:"noopener noreferrer"}},[e._v("官方文档"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[e._v("手机上的app运行状态分前台和后台")]),e._v(" "),s("ul",[s("li",[e._v("前台运行时可以接收到消息推送，但是不会有消息栏的提醒(这是手机的默认行为)，对于安卓，如果要在前台显示推送，推荐使用"),s("a",{attrs:{href:"https://github.com/katzer/cordova-plugin-local-notifications#readme",target:"_blank",rel:"noopener noreferrer"}},[e._v("cordova-plugin-local-notification"),s("OutboundLink")],1),e._v(" 插件")]),e._v(" "),s("li",[e._v("后台运行或关闭时，手机收到推送会显示消息栏，如果用户点击通知，app会显示在前台，通知内容会被JS回调接收。如果不点击或关闭，通知将一直存在。")])])]),e._v(" "),s("li",[s("p",[e._v("我们项目中使用的是"),s("a",{attrs:{href:"https://github.com/dpa99c/cordova-plugin-firebasex",target:"_blank",rel:"noopener noreferrer"}},[e._v("cordova-plugin-firebasex"),s("OutboundLink")],1),e._v(" ，有个bug，手机息屏接收消息很快，亮屏app后台运行接收不稳定。")])]),e._v(" "),s("li",[s("p",[e._v("关于通知权限，对于安卓，不需要授权，但是对于apple，需要调用请求授权方法，如我们用到的"),s("code",[e._v("cordova-plugin-firebasex")]),e._v("插件需要调用提供的"),s("code",[e._v("grantpermission")]),e._v("方法。")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://pek3b.qingstor.com/hexo-blog/hexo-blog/20210907172030.png",alt:""}})])]),e._v(" "),s("li",[s("p",[e._v("FCM发送推送分三种类型：")]),e._v(" "),s("ul",[s("li",[e._v("按设备ID(针对性强，可以只发给某几台设备)，需要传"),s("code",[e._v("device token")])]),e._v(" "),s("li",[e._v("按"),s("code",[e._v("topic")]),e._v("主题，比如定义一个名为"),s("code",[e._v("ad")]),e._v("的topic，只有订阅这个topic的设备才能接收到通知")]),e._v(" "),s("li",[e._v("按target目标，这应该是firebase的特色，你可以针对某平台(ios或android),某个国家，某目标人群等统计相关参数发推送，很灵活。但是需要创建firebase创建项目时候开启google analysis")])]),e._v(" "),s("p",[s("img",{attrs:{src:"https://pek3b.qingstor.com/hexo-blog/hexo-blog/20210907171050.png",alt:""}})])]),e._v(" "),s("li",[s("p",[e._v("APN(Apple Push Notification)，不像安卓生态那么混乱，苹果生态中所有通知都走APN，大致流程：firebase通知APN，APN通知apple设备客户端。"),s("a",{attrs:{href:"https://developer.apple.com/documentation/usernotifications",target:"_blank",rel:"noopener noreferrer"}},[e._v("技术文档"),s("OutboundLink")],1),e._v("，\nfirebase连APN需要我们在apple后台生成验权文件，就是P8或P12，后面会讲。")])]),e._v(" "),s("li",[s("p",[e._v("对于安卓，确保在firebase项目设置中生成了"),s("code",[e._v("google-services.json")]),e._v("文件，对于ios，要生成"),s("code",[e._v("GoogleService-Info.plist")]),e._v("文件，生成文件在放到cordova项目根目录，对于ios，还需要到苹果开发者后后台生成p8或p12文件并上传到firebase项目ios集成页面中")])])]),e._v(" "),s("blockquote",[s("p",[e._v("强烈建议生成P8认证文件，P12文件有很多缺点: 流程繁琐，区分开发和正式环境，还有有效期。P8和P12文件生成流程参见:"),s("a",{attrs:{href:"https://leancloud.cn/docs/ios_push_cert.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("iOS 推送设置指南"),s("OutboundLink")],1)])]),e._v(" "),s("ul",[s("li",[e._v("消息推送内容可以带"),s("a",{attrs:{href:"http://www.unicode.org/emoji/charts/full-emoji-list.html#1f633",target:"_blank",rel:"noopener noreferrer"}},[e._v("emoji"),s("OutboundLink")],1)])]),e._v(" "),s("h3",{attrs:{id:"集成了如何测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集成了如何测试"}},[e._v("#")]),e._v(" 集成了如何测试？")]),e._v(" "),s("p",[e._v("如果是用的Cordova集成消息推送，建议先运行这个插件的"),s("a",{attrs:{href:"https://github.com/dpa99c/cordova-plugin-firebasex-test",target:"_blank",rel:"noopener noreferrer"}},[e._v("demo项目"),s("OutboundLink")],1),e._v("\n安卓手机模拟器可以收到推送消息，苹果的必须真机，收到推送消息的前提的运行获取"),s("code",[e._v("FCM ID")]),e._v("和"),s("code",[e._v("FCM token")]),e._v("成功(记得开代理，或者保证能访问google)")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://pek3b.qingstor.com/hexo-blog/hexo-blog/20210908154923.png",alt:""}})]),e._v(" "),s("p",[s("img",{attrs:{src:"https://pek3b.qingstor.com/hexo-blog/hexo-blog/20210908154954.png",alt:""}})]),e._v(" "),s("h3",{attrs:{id:"如何使用命令行发送消息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何使用命令行发送消息"}},[e._v("#")]),e._v(" 如何使用命令行发送消息")]),e._v(" "),s("p",[e._v("可以直接用"),s("code",[e._v("curl")]),e._v("命令调用"),s("code",[e._v("https://fcm.googleapis.com/v1/projects/${project-id}/messages:send")]),e._v("发送消息\n"),s("code",[e._v("${project-id}")]),e._v(" 替换成firebase中project setting页面中生成的")]),e._v(" "),s("div",{staticClass:"language-shell script line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -X POST -H "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Authorization: Bearer ya29.ElqKBGN2Ri_Uz...HnS_uNreA"')]),e._v(" -H "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Content-Type: application/json"')]),e._v(" -d "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('\'{\n  "message": {\n    "topic" : "my-topic",\n    "notification": {\n      "body": "This is a Firebase Cloud Messaging Topic Message!",\n      "title": "FCM Message"\n    }\n  }\n}\'')]),e._v(" https://fcm.googleapis.com/v1/projects/myproject-b5ae1/messages:send HTTP/1.1\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),s("p",[e._v("https://juejin.cn/post/6844904153274155022")]),e._v(" "),s("p",[e._v("https://github.com/katzer/cordova-plugin-local-notifications#readme")]),e._v(" "),s("p",[e._v("https://www.npmjs.com/package/cordova-plugin-fcm-with-dependecy-updated")]),e._v(" "),s("p",[e._v("https://developer.apple.com/documentation/usernotifications")])])}),[],!1,null,null,null);t.default=a.exports}}]);