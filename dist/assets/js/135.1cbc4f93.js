(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{572:function(s,a,t){"use strict";t.r(a);var n=t(30),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("可以为playbook中的任务打tag标签，方便在ansible-playbook中设置只执行哪些被打上tag的任务或忽略被打上tag的任务。")]),s._v(" "),t("h3",{attrs:{id:"使用-tag-为-task-分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-tag-为-task-分类"}},[s._v("#")]),s._v(" 使用 tag 为 task 分类")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" make sure apache is running\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=httpd state=started\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apache\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" make sure mysql is running\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=mysqld state=started\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("以下是ansible-playbook命令关于tag的选项。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("--list-tags           # list all available tags\n-t TAGS, --tags=TAGS  # only run plays and tasks tagged with these values\n--skip-tags=SKIP_TAGS # only run plays and tasks whose tags do not match these values\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"使用-include-import-和-roles-提高-playbook-的复用性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-include-import-和-roles-提高-playbook-的复用性"}},[s._v("#")]),s._v(" 使用 include，import 和 roles 提高 playbook 的复用性")]),s._v(" "),t("p",[s._v("如果playbook很大，task很多，或者某task要经常使用，可以考虑拆分位独立文件。")]),s._v(" "),t("p",[s._v("Ansible 2.4 起引入 include 和 import 的概念")]),s._v(" "),t("ul",[t("li",[s._v("import 是静态导入，会在playbooks解析阶段将父和子task变量全部读取并加载\nimport_playbook, import_tasks 等")]),s._v(" "),t("li",[s._v("include 是动态导入，执行play之前才加载变量\ninclude_tasks, include_role 等")])]),s._v(" "),t("h6",{attrs:{id:"导入-task"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导入-task"}},[s._v("#")]),s._v(" 导入 task")]),s._v(" "),t("p",[s._v("导入task可以使用\nimport_tasks：\ninclude_tasks")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# playbook.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- task/ntupdate.yml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" centos7\n       "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("import_tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" task/ntupdate.yaml\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ntupdate.yml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" execute ntpdate\n       "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/sbin/ntpdate ntp1.aliyun.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("blockquote",[t("p",[s._v("虽然仍然可以用 "),t("code",[s._v("include: task/ntupdate.yaml")]),s._v(" 来直接导入 task 或 playbook 已经不推荐这么做，将来会被废弃")])]),s._v(" "),t("h6",{attrs:{id:"导入-playbook"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导入-playbook"}},[s._v("#")]),s._v(" 导入 playbook")]),s._v(" "),t("p",[s._v("即加载一个或多个play\n导入playbook可以使用  import_playbook")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" first demo\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cloud\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("vars")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" finley\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" execute date cmd\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" echo date\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" create hello\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" touch helloworld.txt\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creates")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /tmp/hello.txt "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存在此文件就不执行 shell")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("include_tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tasks/task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("hello.yml\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("import_playbook")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" playbooks/web.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h3",{attrs:{id:"role"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#role"}},[s._v("#")]),s._v(" Role")]),s._v(" "),t("p",[s._v("role 需要一个特定的目录结构，执行时会自动加载定义好的文件如vars_files,tasks,handles等\n通过role进行内容分组方便与其他用户分享role。")]),s._v(" "),t("p",[s._v("roles 可以解决文件混乱和playbook臃肿的问题")]),s._v(" "),t("p",[s._v("示例项目结构")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("site.yml\nwebservers.yml\nfooservers.yml\nroles/\n   common/\n     tasks/\n     handlers/\n     files/\n     templates/\n     vars/\n     defaults/\n     meta/\n   webservers/\n     tasks/\n     defaults/\n     meta/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("ul",[t("li",[s._v("tasks 目录：存放task列表。若role要生效，此目录必须要有一个主task文件main.yml，在main.yml中可以使用 include包含同目录(即tasks)中的其他文件。")]),s._v(" "),t("li",[s._v("handlers 目录: 存放handlers的目录，若要生效，则文件必须名为main.yml文件。")]),s._v(" "),t("li",[s._v("files目录：在task中执行copy或script模块时，如果使用的是相对路径，则会到此目录中寻找对应的文件。")]),s._v(" "),t("li",[s._v("templates 目录：在task中执行template模块时，如果使用的是相对路径，则会到此目录中寻找对应的模块文件。")]),s._v(" "),t("li",[s._v("vars目录：定义专属于该role的变量，如果要有var文件，则必须为main.yml文件。")]),s._v(" "),t("li",[s._v("defaults 目录：定义角色默认变量，角色默认变量的优先级最低，会被任意其他层次的同名变量覆盖。如果要有var文件，则必须为main.yml文件。")]),s._v(" "),t("li",[s._v("meta 目录：用于定义角色依赖(dependencies)，如果要有角色依赖关系，则文件必须为main.yml。")])]),s._v(" "),t("h3",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse.html"),t("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);