(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{578:function(e,r,t){"use strict";t.r(r);var o=t(30),a=Object(o.a)({},(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h3",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[e._v("#")]),e._v(" 背景")]),e._v(" "),t("p",[e._v("MySQL本身是开源的，有些公司或社区基于MySQL发布了新的分支，如有名的MariaDB。\n在介绍 Percona 之前，首要要介绍的是XtraDB存储引擎，在MYSQL中接触比较多的是MyISAM 和 InnoDB这两个存储引擎。\nMySQL 4 和 5 使用默认的 MyISAM 存储引擎安装每个表。从5.5开始，MySQL已将默认存储引擎从 MyISAM 更改为 InnoDB。MyISAM 没有提供事务支持，而 InnoDB 提供了事务支持。与 MyISAM 相比，InnoDB 提供了许多细微的性能改进，并且在处理潜在的数据丢失时提供了更高的可靠性和安全性。\nPercona Server由领先的MySQL咨询公司Percona发布。Percona Server是一款独立的数据库产品，其可以完全与MySQL兼容，可以在不更改代码的情况了下将存储引擎更换成XtraDB 。")]),e._v(" "),t("p",[e._v("Percona XtraDB Cluster 完全兼容MySQL。")]),e._v(" "),t("h3",{attrs:{id:"常见mysql集群方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见mysql集群方案"}},[e._v("#")]),e._v(" 常见MySQL集群方案")]),e._v(" "),t("blockquote",[t("p",[t("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-b3a31222b9e4f607.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])]),e._v(" "),t("h3",{attrs:{id:"percona-xtradb-cluster优缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#percona-xtradb-cluster优缺点"}},[e._v("#")]),e._v(" Percona XtraDB Cluster优缺点")]),e._v(" "),t("p",[e._v("优点：\n1.当执行一个查询时，在本地节点上执行。因为所有数据都在本地，无需远程访问。\n2.无需集中管理。可以在任何时间点失去任何节点，但是集群将照常工作。\n3.良好的读负载扩展，任意节点都可以查询。")]),e._v(" "),t("p",[e._v("缺点：\n1.加入新节点，开销大。需要复制完整的数据。\n2.不能有效的解决写缩放问题，所有的写操作都将发生在所有节点上。\n3.有多少个节点就有多少重复的数据。")]),e._v(" "),t("h3",{attrs:{id:"基于docker的实现流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于docker的实现流程"}},[e._v("#")]),e._v(" 基于Docker的实现流程")]),e._v(" "),t("ol",[t("li",[e._v("拉镜像 "),t("code",[e._v("docker pull percona/percona-xtradb-cluster:5.7")])]),e._v(" "),t("li",[e._v("镜像名字有点长，起个短点的\n"),t("code",[e._v("docker tag percona/percona-xtradb-cluster:5.7 pxc")])]),e._v(" "),t("li",[e._v("出于安全考虑，针对PXC集群实例创建内部网络\n创建的时候通过参数指定IP段和子网掩码，Docker默认使用的IP 172.17.0.1，我们换个别的。\n"),t("code",[e._v("docker network create --subnet=172.18.0.0/24 pxc-network")])]),e._v(" "),t("li",[e._v("创建第一个节点\n"),t("code",[e._v("docker run -d -p 33010:3306 -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=pxc_cluster --name=pxc_node1 --net=pxc-network --ip=172.18.0.2 pxc")]),e._v("\n执行 docker logs pxc_node1\n查看执行状态，如果看到 mysqld: ready for connections.\n就可以使用navicat等工具测试连接。")]),e._v(" "),t("li",[e._v("创建第二个数据库节点，并加入到第一个集群中，注意多了 CLUSTER_JOIN 参数\n"),t("code",[e._v("docker run -d -p 33011:3306 -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=pxc_cluster -e CLUSTER_JOIN=pxc_node1 --name=pxc_node2 --net=pxc-network --ip=172.18.0.3 pxc")])]),e._v(" "),t("li",[e._v("创建第三个数据库节点，并加入到第一个集群中，注意多了 CLUSTER_JOIN 参数\n"),t("code",[e._v("docker run -d -p 33012:3306 -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=pxc_cluster -e CLUSTER_JOIN=pxc_node1 --name=pxc_node3 --net=pxc-network --ip=172.18.0.4 pxc")])]),e._v(" "),t("li",[e._v("接下来可以创建第N个节点，注意参数如容器名称 --name 和映射的端口别冲突；")]),e._v(" "),t("li",[e._v("测试：本地连接这三个节点，在其中一个创建demo数据，其他节点都自动同步数据过去了")])]),e._v(" "),t("blockquote",[t("p",[t("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-a15a5fd679269219.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])]),e._v(" "),t("h3",{attrs:{id:"注意"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[e._v("#")]),e._v(" 注意")]),e._v(" "),t("ol",[t("li",[e._v("启动第一个节点后记得使用docker logs查看启动状态，然后使用navicat等工具测试连接，等第一个mysql运行成功后再运行第二个容器。否则第二个起不来，需要重新启动容器。")]),e._v(" "),t("li",[e._v("如果停掉某一节点 "),t("code",[e._v("docker stop pxc_node1")]),e._v(" 再启动时 "),t("code",[e._v("docker start pxc_node1")]),e._v(" 可能会发现连接不上了。这时候可以删除容器，重新运行，命令类似 "),t("code",[e._v("docker run -d -p 33010:3306 -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=pxc_cluster -e CLUSTER_JOIN=pxc_node2 --name=pxc_node1 --net=pxc-network --172.18.0.2 pxc")])])]),e._v(" "),t("h3",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),t("p",[e._v("https://www.percona.com/doc/percona-xtradb-cluster/LATEST/install/docker.html\nhttps://www.percona.com/doc/percona-xtradb-cluster/5.7/index.html")])])}),[],!1,null,null,null);r.default=a.exports}}]);