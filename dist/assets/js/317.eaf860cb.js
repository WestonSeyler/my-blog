(window.webpackJsonp=window.webpackJsonp||[]).push([[317],{754:function(e,t,s){"use strict";s.r(t);var a=s(30),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[e._v("localStorage 大家应该都不会陌生，可以记录一些非敏感的网站数据，比如购物车内的商品数量。\n但是有个问题是，如果用户用浏览器打开了多个Tab。在一个 Tab 中添加一个商品到购物车，其他 Tab 的购物车数量并不会发生变化。\n这时候可以考虑使用 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/storage_event",target:"_blank",rel:"noopener noreferrer"}},[e._v("StorageEvent"),s("OutboundLink")],1),e._v("\n当修改了(localStorage或sessionStorage)数据时，会触发此事件。")]),e._v(" "),s("p",[e._v("使用StorageEvent非常简单，代码如下：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("window.addEventListener('storage', () => {\n  // When local storage changes, dump the list to\n  // the console.\n  console.log(JSON.parse(window.localStorage.getItem('sampleList')));    \n});\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[e._v("其他写法：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("window.onstorage = () => {\n  // When local storage changes, dump the list to\n  // the console.\n  console.log(JSON.parse(window.localStorage.getItem('sampleList')));    \n};\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[e._v("购物车的完整例子，你可以开多个tab实验：\n"),s("a",{attrs:{href:"https://jsbin.com/radekilosu/1/edit?html,css,js,output",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://jsbin.com/radekilosu/1/edit?html,css,js,output"),s("OutboundLink")],1)]),e._v(" "),s("blockquote",[s("p",[s("img",{attrs:{src:"https://hexo-blog.pek3b.qingstor.com/upload_images/71414-cba1808d6be4635a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])]),e._v(" "),s("p",[e._v("另外事件e上还带有很多信息，方便做更多控制。")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("字段")]),e._v(" "),s("th",[e._v("含义")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("key")]),e._v(" "),s("td",[e._v("发生变化的storageKey")])]),e._v(" "),s("tr",[s("td",[e._v("newValue")]),e._v(" "),s("td",[e._v("变换后新值")])]),e._v(" "),s("tr",[s("td",[e._v("oldValue")]),e._v(" "),s("td",[e._v("变换前原值")])]),e._v(" "),s("tr",[s("td",[e._v("storageArea")]),e._v(" "),s("td",[e._v("相关的变化对象")])]),e._v(" "),s("tr",[s("td",[e._v("url")]),e._v(" "),s("td",[e._v("触发变化的URL，如果是frameset内，则是触发帧的URL")])])])]),e._v(" "),s("p",[e._v("关于兼容性：最新的火狐，Chrome，Edge的支持，IE未知")])])}),[],!1,null,null,null);t.default=n.exports}}]);