(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{542:function(t,n,s){"use strict";s.r(n);var e=s(30),a=Object(e.a)({},(function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("这里我已经拥有了一个example.com域名，要生成这个域名的泛域名证书，又不想掏钱买，可以使用Let’s Encrypt")]),t._v(" "),s("p",[t._v("Let’s Encrypt 是一个非盈利的 CA 机构，目的是推动https的发展。\n他们搞了一个非常有创意的事情，设计了一个 ACME 协议。 那为什么要创建 ACME 协议呢，传统的 CA 机构是人工受理证书申请、证书更新、证书撤销，完全是手动处理的。而 ACME 协议规范化了证书申请、更新、撤销等流程，只要一个客户端实现了该协议的功能，通过客户端就可以向 Let’s Encrypt 申请证书，也就是说 Let’s Encrypt CA 完全是自动化操作的。 任何人都可以基于 ACME 协议实现一个客户端，官方推荐的客户端是Certbot 。\nLet’s Encrypt 支持两种证书，单域名和泛域名\n为防止滥用，申请 Let’s Encrypt 证书的时候，需要校验域名的所有权，目前支持多种验证方式。\n常见的是dns01：给域名添加一个 DNS TXT 记录")]),t._v(" "),s("p",[t._v("Certbot是可以生成的https证书的工具，要使用他，你需要保证：")]),t._v(" "),s("ul",[s("li",[t._v("懂一些命令行")]),t._v(" "),s("li",[t._v("一个http访问的站点，即已经安装并运行了服务器")]),t._v(" "),s("li",[t._v("80端口是开放的")]),t._v(" "),s("li",[t._v("可以通过SSH访问服务器")]),t._v(" "),s("li",[t._v("可以使用sudo\n如果要配置泛域名证书，还需要知道域名的DNS提供商，并且可以修改DNS信息")])]),t._v(" "),s("ol",[s("li",[t._v("安装 certbot")])]),t._v(" "),s("p",[t._v("打开 https://certbot.eff.org/")]),t._v(" "),s("p",[t._v("选择你的服务器和操作系统，\n这里我选择Nginx服务器和Ubuntu18.04版本的操作系统\n接着让你选择生成默认证书（单一域名）还是通配（泛域名）证书\n这里我选择泛域名")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" software-properties-common\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" add-apt-repository universe\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" add-apt-repository ppa:certbot/certbot\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" certbot\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("生成证书\n"),s("code",[t._v("sudo certbot --server https://acme-v02.api.letsencrypt.org/directory -d *.example.com -d example.com --manual --preferred-challenges dns-01 certonly --agree-tos --manual-public-ip-logging-ok")])])]),t._v(" "),s("p",[t._v("修改"),s("code",[t._v("example.com")]),t._v("为实际的域名")]),t._v(" "),s("p",[t._v("会提示\n`\nPlease deploy a DNS TXT record under the name\n_acme-challenge.example.com with the following value:")]),t._v(" "),s("p",[t._v("CqlWZaGWFSC1sj7Jww2juz9VJIzzJwWWoo-WUu-1Dow\n`")]),t._v(" "),s("p",[t._v("这时候需要去域名DNS管理后台添加相应记录，不要着急next回车，因为DNS生效可能要等5-10分钟\n回车后，如果出现")]),t._v(" "),s("p",[t._v("`\nIMPORTANT NOTES:")]),t._v(" "),s("ul",[s("li",[s("p",[t._v('Congratulations! Your certificate and chain have been saved at:\n/etc/letsencrypt/live/example.com/fullchain.pem\nYour key file has been saved at:\n/etc/letsencrypt/live/example.com/privkey.pem\nYour cert will expire on 2020-12-28. To obtain a new or tweaked\nversion of this certificate in the future, simply run certbot\nagain. To non-interactively renew all of your certificates, run\n"certbot renew"')])]),t._v(" "),s("li",[s("p",[t._v("If you like Certbot, please consider supporting our work by:")]),t._v(" "),s("p",[t._v("Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate\nDonating to EFF:                    https://eff.org/donate-le\n`")])])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("修改nginx配置，可以参考下面的配置，我的网站需要跑PHP")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server {\n\n    root /var/html/www;\n\n\t# Add index.php to the list if you are using PHP\n\tindex index.php index.html index.htm index.nginx-debian.html;\n\n    # 修改为泛域名\n\tserver_name *.example.com;\n\n\tlocation / {\n\t\t# First attempt to serve request as file, then\n\t\t# as directory, then fall back to displaying a 404.\n\t\t# try_files $uri $uri/ =404;\n\t\ttry_files $uri $uri/ /index.php?$query_string;\n\t}\n\n    location = /favicon.ico { access_log off; log_not_found off; }\n    location = /robots.txt  { access_log off; log_not_found off; }\n\n\terror_page 404 /index.php;\n\n\t# pass PHP scripts to FastCGI server\n\t#\n\tlocation ~ \\.php$ {\n\t\tinclude snippets/fastcgi-php.conf;\n\t#\n\t#\t# With php-fpm (or other unix sockets):\n\t\tfastcgi_pass unix:/var/run/php/php7.2-fpm.sock;\n\t#\t# With php-cgi (or other tcp sockets):\n\t#\tfastcgi_pass 127.0.0.1:9000;\n\t}\n\n    listen [::]:443 ssl ipv6only=on; # managed by Certbot\n    listen 443 ssl; # managed by Certbot\n    # 注意路径，改为刚才生成后显示的\n    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem; # managed by Certbot\n    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem; # managed by Certbot\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n\n}\n\nserver {\n    # http 转 https重定向\n\trewrite ^(.*) https://$host$1 permanent;\n\tlisten 80 default_server;\n\tlisten [::]:80 default_server;\n\n\tserver_name *.course.intogolf.nl;\n    return 404; # managed by Certbot\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br"),s("span",{staticClass:"line-number"},[t._v("51")]),s("br"),s("span",{staticClass:"line-number"},[t._v("52")]),s("br")])]),s("ol",{attrs:{start:"4"}},[s("li",[s("p",[t._v("sudo nginx -t 检查配置，无误后 sudo nginx -s reload")])]),t._v(" "),s("li",[s("p",[t._v("letsencrypt的证书有效期是三个月，可设置crontab自动任务进行更新")])])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("30 1 10 * * /usr/bin/certbot renew && /usr/sbin/nginx -s reload # 每月10日1点30分执行一次\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("先"),s("code",[t._v("which certbot")]),t._v("确定"),s("code",[t._v("certbot")]),t._v("实际的位置")]),t._v(" "),s("h3",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),s("p",[t._v("https://certbot.eff.org/lets-encrypt/ubuntubionic-nginx")]),t._v(" "),s("p",[t._v("https://blog.csdn.net/zcyuefan/article/details/82986844")]),t._v(" "),s("p",[t._v("https://www.jianshu.com/p/c6f6f277a23d")])])}),[],!1,null,null,null);n.default=a.exports}}]);